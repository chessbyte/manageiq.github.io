<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />
  
  <link type="text/css" rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://manageiq.org/docs/reference/latest/auth/openid_connect">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/reference/latest/auth/openid_connect">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li class="active">
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li>
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

    <div class="col-lg-4 col-md-4 col-sm-12 pull-right" style="margin-top: 10px">
        <script async src="https://cse.google.com/cse.js?cx=006042792541147862616:dfkijfebdts"></script>
         <div class="gcse-search"></div>
    </div>
</nav>

<script>
  window.onload = demo;
	function demo() {
	    document.getElementById("gsc-i-id1").setAttribute("placeholder", "Search Documentation")
	}
</script>

<div class="doc_container">
  <div class="doc_menu">
    
    

<div class="doc_menu-heading">
  Latest
</div>

<ul class="menu menu-toplevel" id=ref_menu_latest>


  <li class="menu-parent">
    
    <a href="#">
      Installation
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_AWS/miq">
      Amazon Web Services (AWS)
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_Microsoft_Azure/miq">
      Microsoft Azure
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_Google_Compute_Engine/miq">
      Google Compute Engine
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_VMware_vSphere/miq">
      VMware vSphere
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_Red_Hat_Enterprise_Linux_OpenStack_Platform/miq">
      Red Hat Enterprise OpenStack Platform
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_Red_Hat_Virtualization/miq">
      Red Hat Enterprise Virtualization
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Installing_on_SCVMM/miq">
      Microsoft System Center Virtual Machine Manager (SCVMM)
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Administration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Monitoring_Alerts_and_Reporting/miq">
      Monitoring, Alerts, and Reporting
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Policies_and_Profiles_Guide/miq">
      Policies and Profiles Guide
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Managing_Infrastructure_and_Inventory/miq">
      Managing Infrastructure and Inventory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Managing_Providers/miq">
      Managing Providers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Provisioning_Virtual_Machines_and_Hosts/miq">
      Provisioning Virtual Machines and Hosts
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Scripting_Actions/miq">
      Scripting Actions in ManageIQ
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Authentication
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/active_directory">
      Active Directory
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ipa_2fa">
      2-Factor-Authentication with IPA
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ipa_ad_trust">
      IPA/AD Trust
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/ldap">
      LDAP
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/auth/saml">
      SAML
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item active">
    <a href="/docs/reference/latest/auth/openid_connect">
      OpenID-Connect
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Integration
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Integration_with_AWS_CloudFormation_and_OpenStack_Heat/miq">
      AWS CloudFormation and OpenStack Heat
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Integration_with_ServiceNow/miq">
      ServiceNow
    </a>
    
  </li>


      </ul>
    
  </li>


  <li class="menu-parent">
    
    <a href="#">
      Reference
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-REST_API/miq">
      ManageIQ REST API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/reference/latest/doc-Methods_Available_for_Automation/miq">
      Methods Available for Automation
    </a>
    
  </li>


      </ul>
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc user_doc">
      

      <div class="doc-content">
        
        <div class="doc-versions">
          <span class="label">Versions: </span>
          
          <span>
            <a href="/docs/reference/hammer/auth/openid_connect.html">
              Hammer
            </a>
          </span>
          <span class="separator">/</span>
          
          <span>
            <a href="/docs/reference/ivanchuk/auth/openid_connect.html">
              Ivanchuk
            </a>
          </span>
          <span class="separator">/</span>
          
          <span class="active" >
            <a href="/docs/reference/latest/auth/openid_connect.html">
              Latest
            </a>
          </span>
          <span class="separator">/</span>
          
        </div>
        
        <div class="sect1">
<h2 id="openid-connect"><a class="anchor" href="#openid-connect"></a>OpenID-Connect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External Authentication on the Appliance has been enhanced to support OpenID-Connect,
which will also be referred to as <em>OIDC</em>.</p>
</div>
<div class="paragraph">
<p>The OIDC implementation has been tested with KeyCloak 3.2.1.</p>
</div>
<div class="paragraph">
<p>In this guide we will cover how to manually configure an Appliance&#8217;s
external authentication to work with OIDC. The OIDC implementation has been
tested with KeyCloak but is implemented generically using Apache&#8217;s mod_auth_openidc
module and should work with other OIDC Identity Providers.</p>
</div>
<div class="paragraph">
<p>The current implementation only secures the Appliance&#8217;s Web administrative UI with OIDC.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The REST API and Self-Service UI do not currently support OIDC.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#requirements">Requirements</a></p>
</li>
<li>
<p><a href="#apache-configuration">Apache Configuration</a></p>
</li>
<li>
<p><a href="#oidc-configuration">OIDC Configuration</a></p>
</li>
<li>
<p><a href="#oidc-assertions">OIDC Assertions</a></p>
</li>
<li>
<p><a href="#configuring-the-administrative-ui">Configuring the Administrative UI</a></p>
</li>
<li>
<p><a href="#re-enabling-local-login">Re-Enabling Local Login</a></p>
</li>
<li>
<p><a href="#oidc-configuration-cli">Configuring OIDC using the CLI</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is needed in order to enable OIDC Authentication to the Appliance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A CentOS/RHEL 7.5 based Appliance</p>
</li>
<li>
<p>A OIDC Identity Provider, (e.g. KeyCloak 3.2.1 or Later)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="apache-configuration"><a class="anchor" href="#apache-configuration"></a>Apache Configuration</h3>
<div class="paragraph">
<p>Copy the Apache OIDC template configuration files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># TEMPLATE_DIR="/var/www/miq/system/TEMPLATE"
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-remote-user-openidc.conf \
    /etc/httpd/conf.d/
# cp ${TEMPLATE_DIR}/etc/httpd/conf.d/manageiq-external-auth-openidc.conf.erb \
    /etc/httpd/conf.d/manageiq-external-auth-openidc.conf</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="oidc-configuration"><a class="anchor" href="#oidc-configuration"></a>OIDC Configuration</h3>
<div class="paragraph">
<p>The Apache <em>/etc/httpd/conf.d/manageiq-external-auth-openidc.conf</em> configuration files must be updated
with installation specific values:</p>
</div>
<div class="paragraph">
<p>The defaults in the <em>manageiq-external-auth-oidc.conf</em> file are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LogLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">warn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDCCryptoPassphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sp-cookie</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDCOAuthRemoteUserClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Installation specific values must be specified in the <em>manageiq-external-auth-oidc.conf</em> file for the following
parameters, where the <em>parameter</em> including the &lt;%= &#8230;&#8203; %&gt; anchors
need to be replaced with the appropriate values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServerName</p>
<p class="tableblock">and</p>
<p class="tableblock">OIDCRedirectURI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">miq_appliance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FQDN of the appliance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDCProviderMetadataURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oidc_provider_metadata_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID-Connect Provider URL,
i.e. <a href="http://&lt;keycloak_server&gt;:8080/auth/realms/miq/.well-known/openid-configuration" class="bare">http://&lt;keycloak_server&gt;:8080/auth/realms/miq/.well-known/openid-configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDCClientID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oidc_client_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID-Connect Client ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDCClientSecret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oidc_client_secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID-Connect Client Secret</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For KeyCloak, a Realm can be created for one or more Appliances with individual Clients
defined one per Appliance where the Client ID identifies the individual appliance,
e.g. the appliance hostname.</p>
</div>
<div class="paragraph">
<p>Adding a Client in the KeyCloak ManageIQ Realm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set Client ID as &lt;miq-appliance&gt;</p>
</li>
<li>
<p>Set Client protocol as <strong>openid-connect</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Client definition for the appliance can then be updated with the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openid-connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">confidential</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid Redirect URIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance>" class="bare">https://&lt;miq-appliance></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://&lt;miq-appliance&gt;/oidc_login/redirect_uri" class="bare">https://&lt;miq-appliance&gt;/oidc_login/redirect_uri</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Info Signed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request Object Signature Algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value used for OIDCClientSecret (<em>oidc_client_secret</em>) in the <em>manageiq-external-auth-oidc.conf</em> file is taken
from the Keycloak Client&#8217;s <em>Credentials / Secret</em> value. To generate a new client secret,
First set the <em>Credentials / Client Authenticator</em> to <em>Client Id and Secret</em>
. Then <em>Regenerate Secret</em> button.</p>
</div>
<div class="paragraph">
<p>Finally, restart Apache on the appliance as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># systemctl restart httpd</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="oidc-assertions"><a class="anchor" href="#oidc-assertions"></a>OIDC Assertions</h4>
<div class="paragraph">
<p>For authenticating to the appliance, the following remote user parameters are looked at by
the appliance upon a successful login and redirect from the Identity Provider.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Environment</th>
<th class="tableblock halign-left valign-top">OIDC Assertion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_EMAIL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_FIRSTNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_LASTNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_FULLNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REMOTE_USER_GROUPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groups</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For KeyCloak, the above OIDC Assertions can be created for the Appliance Client in KeyCloak as
Mappers.</p>
</div>
<div class="paragraph">
<p>The following mappers are automatically generated when the OIDC client is created:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Category</th>
<th class="tableblock halign-center valign-top">Mapper Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Token mapper</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Property</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">family name</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Token mapper</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Property</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">given name</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Token mapper</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Property</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">full name</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Token mapper</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User&#8217;s full name</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Token mapper</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Property</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following <em>Group Membership</em> mapper must be manually created:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Consent Required</th>
<th class="tableblock halign-center valign-top">Mapper Type</th>
<th class="tableblock halign-center valign-top">Token Claim Name</th>
<th class="tableblock halign-center valign-top">Full group path</th>
<th class="tableblock halign-center valign-top">Add to ID token</th>
<th class="tableblock halign-center valign-top">Add to access token</th>
<th class="tableblock halign-center valign-top">Add to userinfo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">groups</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Group Membership</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">groups</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following <em>User Session Note</em> mappers must be manually created:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Consent Required</th>
<th class="tableblock halign-center valign-top">Mapper Type</th>
<th class="tableblock halign-center valign-top">User Session Note</th>
<th class="tableblock halign-center valign-top">Token Claim Name</th>
<th class="tableblock halign-center valign-top">Claim JSON Type</th>
<th class="tableblock halign-center valign-top">Add to ID token</th>
<th class="tableblock halign-center valign-top">Add to access token</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Client Host</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Session Note</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientHost</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientHost</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Client ID</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Session Note</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Client IP Address</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">User Session Note</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientAddress</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">clientAddress</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ON</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-administrative-ui"><a class="anchor" href="#configuring-the-administrative-ui"></a>Configuring the Administrative UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After having configured Apache for OIDC, the next step is to update the Appliance Administrative UI
to be OIDC aware and function accordingly.</p>
</div>
<div class="paragraph">
<p>Login as admin, then in <em>Configure&#8594;Configuration&#8594;Authentication</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set mode to External (httpd)</p>
</li>
<li>
<p>Check: <em>Provider Type: Enable Enable OpenID-Connect</em> - This enables the OIDC login button on the login screen, that redirects
to the OIDC protected page for authentication, and supports the OIDC logout process.</p>
</li>
<li>
<p>Optional: Check: <em>Enable Single Signon</em> - With this option enabled, initial access to the Appliance Administrative UI will
redirect to the OIDC Identity Provider authentication screen.  Note that logouts from the Appliance will
return the user to the Appliance login screen allowing them to login as admin unless <em>Disable Local Login</em>
is checked below.</p>
</li>
<li>
<p>Optional: Check: <em>Disable Local Login</em> - Do this <strong>only</strong> if you need to disable <em>admin</em> login to appliance and only
allow OIDC based authentication.  Note that if there are issues with the Identity Provider or you need
admin access to the appliance you won&#8217;t be able to login until you re-enable the Local Login
as described below.</p>
</li>
<li>
<p>Check: <em>Get User Groups from External Authentication (httpd)</em></p>
</li>
<li>
<p>Click Save.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above steps need to be done on each UI enabled appliance.</p>
</div>
<div class="paragraph">
<p>In Configure&#8594;Configuration&#8594;Access Control</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the user&#8217;s groups are created on the Appliance and appropriate roles assigned to those groups.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="re-enabling-local-login"><a class="anchor" href="#re-enabling-local-login"></a>Re-Enabling Local Login</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the Local Login has been disabled in the Administrative UI and there is a need to be able
to login as <em>admin</em>, the Local Login can be re-enabled using either of the following methods:</p>
</div>
<div class="sect2">
<h3 id="administrative-ui"><a class="anchor" href="#administrative-ui"></a>Administrative UI:</h3>
<div class="paragraph">
<p>This option is available if the Identity Provider is available and one can login using a user
with enough administrative privileges to update it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login as administrative user,</p>
</li>
<li>
<p>In then in <em>Configure&#8594;Configuration&#8594;Authentication</em> uncheck <em>Disable Local Login</em> and save.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="appliance-console-interface"><a class="anchor" href="#appliance-console-interface"></a>Appliance Console Interface:</h3>
<div class="ulist">
<ul>
<li>
<p>ssh to the appliance as root</p>
</li>
<li>
<p>Run <em>appliance_console</em></p>
</li>
<li>
<p>Select menu entry <em>Update External Authentication Options</em></p>
</li>
<li>
<p>Select <em>Enable Local Login</em></p>
</li>
<li>
<p>then <em>Apply updates</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="appliance-console-cli"><a class="anchor" href="#appliance-console-cli"></a>Appliance Console CLI:</h3>
<div class="ulist">
<ul>
<li>
<p>ssh to the appliance as root</p>
</li>
<li>
<p>Run <em>appliance_console_cli --extauth-opts</em> <strong>local_login_disabled=false</strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="oidc-configuration-cli"><a class="anchor" href="#oidc-configuration-cli"></a>Configuring OIDC using the CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another way to configure OpenID-Connect on the appliance is to use the appliance
console CLI instead of the above steps. The <code>--oidc-config</code> subcommand of
the appliance console CLI allows one to configure the appliance for OpenID-Connect
Authentication by updating both Apache configurations as well as the necessary
Administrative UI settings. The <code>--oidc-unconfig</code> subcommand is also provided
for unconfiguring the appliance OpenID-Connect Authentication and reverting
the appliance to Database Authentication.</p>
</div>
<div class="paragraph">
<p>Usage of the new Appliance Console CLI subcommands are as follows:</p>
</div>
<div class="sect2">
<h3 id="configure-openid-connect"><a class="anchor" href="#configure-openid-connect"></a>Configure OpenID-Connect</h3>
<div class="paragraph">
<p>To configure the appliance for OpenID-Connect Authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># appliance_console_cli --oidc-config
                        [--oidc-client-host]
                        --oidc-url
                        --oidc-client-id
                        --oidc-client-secret
                        [--oidc-enable-sso]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>--oidc-client-host</code> is not specified, the configured appliance host
is used for the ServerName and OpenID-Connect Redirect URI in the
OpenID-Connect Apache configuration file. The <code>--oidc-client-host</code> is
usually the externally reachable FQDN of the appliance.</p>
</div>
<div class="paragraph">
<p>Configuring OpenID-Connect requires the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--oidc-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the OpenID-Connect Provider URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--oidc-client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID-Connect Provider Cliend ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--oidc-client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID-Connect Provider Client Secret</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>--oidc-url</code> varies for different providers. An example provider
URL for keycloak:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>--oidc-url=http://keycloak-server:8080/auth/realms/miq-realm/.well-known/openid-configuration</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <strong>miq-realm</strong> being the Keycloak Realm this OpenID-Connect
appliance client is being configured for.</p>
</div>
<div class="paragraph">
<p>The <code>--oidc-client-id</code> is the Client ID specified for
the appliance in the OpenID-Connect provider, usually
just <code>&lt;miq-appliance-fqdn&gt;</code></p>
</div>
<div class="paragraph">
<p>By default, SSO is not enabled, so from the Appliance login page, the user clicks
on Log In to Corporate System to get redirected to the OpenID-Connect
login page. With the <code>--oidc-enable-sso</code> option specified, the Appliance redirects the user
to the OpenID-Connect login page for logging in.</p>
</div>
</div>
<div class="sect2">
<h3 id="unconfigure-openid-connect"><a class="anchor" href="#unconfigure-openid-connect"></a>Unconfigure OpenID-Connect</h3>
<div class="paragraph">
<p>To unconfigure the appliance from OpenID-Connect Authentication and revert to
Database authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># appliance_console_cli --oidc-unconfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will remove the Apache external authentication OpenID-Connect configuration
files and revert the appliance&#8217;s authentication settings to Database mode.</p>
</div>
</div>
</div>
</div>
      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2020 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
  </body>
</html>
