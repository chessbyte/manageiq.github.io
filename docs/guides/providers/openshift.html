<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ</title>
  <meta name="description" content="">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />
  
  <link type="text/css" rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://manageiq.org/docs/guides/providers/openshift">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

  </div>
</header>


    <main data-url="/docs/guides/providers/openshift">
      <nav class="doc_tabs">
  <ul>
  <li>
    <a href="/docs/get-started/">Get Started</a>
  </li>
  <li>
    <a href="/docs/reference/">User Reference</a>
  </li>
  <li>
    <a href="/docs/automation">
      Automation Book
    </a>
  </li>
  <li>
    <a href="/docs/api">
      API Docs
    </a>
  </li>
  <li class="active">
    <a href="/docs/guides/README">Developer Guides</a>
  </li>
</ul>

</nav>

<div class="doc_container">
  <div class="doc_menu">
    
    

<ul class="menu menu-toplevel" id="guides_menu">

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Architecture
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/capacity_and_utilization_collection_explanation">
      Capacity And Utilization Collection Explanation
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/enterprise">
      Enterprise
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/source_code_layout">
      Source Code Layout
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Developer Setup
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/plugins">
      Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/minimal_mode">
      Minimal Mode
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/running_test_suites">
      Running Test Suites
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/developer_setup/debugging">
      Interactive debugging
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      External Auth
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth.html">
      Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/configuration">
      Configuration
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/external_auth/installation">
      Installation
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      User Interface
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/patterns">
      UI Patterns
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/plugins">
      UI Plugins
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/register_react_component">
      Shared React Component API
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/ui/report_data_api">
      Report Data API
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li class="menu-parent">
    
    <a href="#">
      Providers
    </a>
    
    
      <ul>
        



  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_overview">
      Providers Overview
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/architecture/providers_database_architecture.html">
      Providers Database Architecture
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/amazon_aws_config">
      Amazon AWS Config
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/containers">
      Containers
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item active">
    <a href="/docs/guides/providers/openshift">
      Openshift
    </a>
    
  </li>

  
  
  
  <li class="doc_menu-item">
    <a href="/docs/guides/providers/openstack_infra_provider">
      Openstack Infra Provider
    </a>
    
  </li>


      </ul>
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/provisioning/windows_imaging">
      Windows Imaging
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/coding_style_and_standards">
      Coding Style And Standards
    </a>
    
    
  </li>

  
  
  
  <li>
    
    <a href="/docs/guides/i18n">
      I18n
    </a>
    
    
  </li>

</ul>

    
  </div>
  <div class="doc_main">
    <article class="doc dev_doc">
      

      <div class="doc-content">
        
        <h2 id="manageiq-openshift-container-provider">ManageIQ Openshift Container Provider</h2>

<p>Two deployment options are suggested here to deploy an openshift origin
provider for ManageIQ:</p>

<ul>
  <li>using <a href="https://github.com/openshift/openshift-ansible">openshift-ansible</a> to
deploy RPM packages on a cluster</li>
  <li>using <a href="https://github.com/minishift/minishift">minishift</a> to deploy
openshift source to a vm</li>
</ul>

<p>You can also use <code class="highlighter-rouge">oc cluster up</code> and configure it yourself (instructions not
provided) as another alternative.</p>

<h3 id="deploying-openshift-with-ansible">Deploying OpenShift With Ansible</h3>

<p>Get openshift-ansible:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">git</span><span class="kv"> clone https://github.com/openshift/openshift-ansible.git
</span></code></pre>
</div>

<p>Generate an ssh key if needed:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">ssh-keygen</span><span class="kv">
</span></code></pre>
</div>

<p>Configure ssh key authentication to all the machines:</p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">ssh-copy-id</span><span class="kv"> root@hostname
</span></code></pre>
</div>

<p>The inventory file describes all the nodes and masters in the cluster. A simple
example file for a cluster composed of two machines (Master and Node):</p>

<pre><code class="language-INI">[OSEv3:children]
masters
nodes
 
[OSEv3:vars]
ansible_ssh_user=root
deployment_type=origin
 
[masters]
master_hostname openshift_scheduleable=True
 
[nodes]
master_hostname
node_hostname
</code></pre>

<p>There are more like variables like <code class="highlighter-rouge">use_metrics</code> to enable other options in
OpenShift.  A more detailed example can be found in
<code class="highlighter-rouge">inventory/byo/hosts.origin.example</code>. Specifically, to deploy metrics and
logging use <code class="highlighter-rouge">openshift_hosted_metrics_deploy=True</code> and
<code class="highlighter-rouge">openshift_hosted_logging_deploy=True</code></p>

<div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">ansible-playbook</span><span class="kv"> playbooks/byo/config.yml -i path/to/inventory/file
</span></code></pre>
</div>

<h3 id="running-with-minishift">Running with minishift</h3>

<p>For a simple single host setup for working with the openshift provider locally,
you can use <a href="https://github.com/minishift/minishift"><code class="highlighter-rouge">minishift</code></a> to run a
local openshift instance.</p>

<h4 id="requirements">Requirements</h4>

<ul>
  <li><a href="https://github.com/minishift/minishift"><code class="highlighter-rouge">minishift</code></a> &gt;= 1.0.0.rc1 (<a href="https://docs.openshift.org/latest/minishift/getting-started/installing.html#installing-instructions">Installation Instructions</a>)</li>
  <li>Virtualization host of your choice (see supported hypervisors <a href="https://docs.openshift.org/latest/minishift/getting-started/installing.html#install-prerequisites">here</a>)</li>
</ul>

<h4 id="quickstart">Quickstart</h4>

<p>Since VirtualBox is a consistent hypervisor across all platforms, this guide
will assume that is being used, and updates to some commands might be
necessary (most commands should be virtualization software agnostic and work
regardless of the hypervisor).</p>

<ol>
  <li>
    <p>Download and enable the manageiq addon for minishift:</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">mkdir</span><span class="kv"> -p ~/minishift/addons
</span><span class="w">$ </span><span class="nc">git</span><span class="kv"> clone https://gist.github.com/e2fac8be87ea0e9f429b6f5d75e02176 ~/minishift/addons/manageiq
</span><span class="w">$ </span><span class="nc">minishift</span><span class="kv"> addons install --force ~/minishift/addons/manageiq
</span><span class="w">$ </span><span class="nc">minishift</span><span class="kv"> addons enable manageiq
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Start minishift:</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">minishift</span><span class="kv"> start --vm-driver virtualbox --openshift-version "v3.6.1"
</span></code></pre>
    </div>

    <p>You might want to add <code class="highlighter-rouge">--metrics --memory 5G</code>.  As of this writing that only supports hawkular and doesn’t work on 3.7.0.</p>

    <p>See https://hub.docker.com/r/openshift/origin/tags/ for possible versions.</p>
  </li>
  <li>
    <p>Grab the minishift IP:</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">minishift</span><span class="kv"> ip
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Add <code class="highlighter-rouge">oc</code> and/or <code class="highlighter-rouge">docker</code> to your PATH, configured to the cluster (auto-detects correct shell):</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">eval</span><span class="kv"> $(minishift oc-env)
</span><span class="w">$ </span><span class="nc">eval</span><span class="kv"> $(minishift docker-env)
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Grab the token to access openshift through <code class="highlighter-rouge">manageiq</code>:</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">oc</span><span class="kv"> login -u system:admin
</span><span class="w">$ </span><span class="nc">oc</span><span class="kv"> sa get-token -n management-infra management-admin
</span></code></pre>
    </div>
  </li>
  <li>
    <p>Configure a provider in ManageIQ, filling in your token and IP where
appropriate:</p>

    <div class="language-console highlighter-rouge"><pre class="highlight"><code><span class="w">$ </span><span class="nc">bin/rails</span><span class="kv"> c
</span>irb&gt; token = '&lt;&lt;YOUR_TOKEN_FROM_ABOVE_HERE&gt;&gt;'
irb&gt; host  = '&lt;&lt;YOUR_IP_FROM_ABOVE_HERE&gt;&gt;'
irb&gt; os = ManageIQ::Providers::Openshift::ContainerManager
irb&gt; os.create(:name =&gt; "Minishift", :hostname =&gt; host, :port =&gt; 8443, :ipaddress =&gt; host, :zone =&gt; Zone.first, :storage_profiles =&gt; [], :security_protocol =&gt; "ssl-without-validation")
irb&gt; os.last.update_authentication(:bearer =&gt; {:auth_key =&gt; token, :save =&gt; true})
</code></pre>
    </div>

    <p>Or through the UI if you prefer.</p>
  </li>
</ol>

<h3 id="automated-script-to-record-new-vcr">Automated script to record new VCR</h3>

<p>https://github.com/ManageIQ/manageiq-providers-openshift/pull/75 added a script that creates things from template, records 1st vcr, deletes some things, records 2nd.</p>

<p>Currently if you want to copy VCR to manageiq-providers-kubernetes, the spec there assumes Hawkular metrics were running.</p>

<ul>
  <li>
    <p>Easiest to use script with minishift.<br />
Have <code class="highlighter-rouge">minishift</code> in your PATH.
As described above, including manageiq addon.  Don’t need <code class="highlighter-rouge">--metrics</code>.</p>
  </li>
  <li>
    <p>Alternatively bring your own openshift.
Set <code class="highlighter-rouge">OPENSHIFT_MASTER_HOST</code> env var.
Perform <code class="highlighter-rouge">oc login</code> as a user having <code class="highlighter-rouge">cluster-admin</code> role.</p>
  </li>
</ul>

<p>Then run in manageiq-providers-openshift repo:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>./spec/vcr_cassettes/manageiq/providers/openshift/container_manager/test_objects_record.sh
</code></pre>
</div>

<p>You may need to adjust specs if object counts and/or names changed (ideally, figure out why and how to make it more reproducible).</p>

<p>There are text files near the .yml files that help tracking what changed vs previous VCRs, commit them together.</p>

      </div>
    </article>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li >
    <a href="/blog/">Blog</a>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2020 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
  </body>
</html>
