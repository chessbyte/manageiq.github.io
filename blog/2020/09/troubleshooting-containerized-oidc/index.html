<!DOCTYPE html>
<html>

  <head>
  <!DOCTYPE html>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ManageIQ - Troubleshooting OpenID-Connect Authentication on Containers</title>
  <meta name="description" content="The goal of this blog post is to provide a basic understanding of how to troubleshoot ManageIQ configured for OpenID-Connect authentication when deploying Ma...">
  <meta property="og:image" content="http://manageiq.org/assets/images/logo/manageiq-logo-blue.png" />

  <link type="text/css" rel="stylesheet" href="/assets/main-8de063b063e781c83c3900f2fb42692885edeac0346d54e22467184ccc393942.css">
  <link rel="canonical" href="http://manageiq.org/blog/2020/12/2020-09-21-troubleshooting-containerized-oidc/">
  <link rel="alternate" type="application/rss+xml" title="ManageIQ" href="http://manageiq.org/feed.xml">

  <link href="/assets/images/favicon.ico" rel="shortcut icon">
</head>


  <body>
    <header class="site-header">
  <a href="/" class="brand">
    <span class="brand-name">ManageIQ</span>
    <img class="brand-logo" src="/assets/images/manageiq-logo-inverse.svg" alt="ManageIQ Logo">
  </a>

  <div id="site_header-nav_toggle">
    <a href="#" class="off_canvas-show" data-behavior="off_canvas-toggle">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <div class="off_canvas">
    <header class="off_canvas-header">
      <a href="#" class="off_canvas-hide" data-behavior="off_canvas-toggle">
        <i class="fa fa-times"></i>
      </a>
    </header>

    <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li class="active">
    <a href="/blog/">Blog</a>
  </li>
</ul>

  </div>
</header>


    <main data-url="/blog/2020/09/troubleshooting-containerized-oidc/">
      <div class="blog">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-10">
        <header class="blog_header">
          <h1>
            ManageIQ Blog
          </h1>
        </header>
      </div>
    </div>
    <div class="row"> 
      <div class="col-xs-12 col-sm-10 blog_main">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="page-title" itemprop="name headline">Troubleshooting OpenID-Connect Authentication on Containers</h1>

            <div class="post-meta">
              <time datetime="2020-09-21T00:00:00+00:00" itemprop="datePublished">
                Sep 21, 2020
              </time>

              
              <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                by
                <i itemprop="name">
                  jvlcek
                </i>
              </span>
              

              <ul class="post-tags">
                
                <li>
                  <a href="/blog/tags/tutorials">tutorials</a>
                </li>
                
              </ul>
            </div>
          </header>

          <div class="post-content" itemprop="articleBody">
            <p>The goal of this blog post is to provide a basic understanding of how to troubleshoot ManageIQ 
configured for OpenID-Connect authentication when deploying ManageIQ on containers.</p>

<p>The examples were generated using OpenShift.</p>

<h2 id="contents"><strong>Contents:</strong></h2>

<ul>
  <li><a href="#configure-manageiq-for-openid-connect-authentication"><strong>Configure ManageIQ For OpenID-Connect Authentication</strong></a></li>
  <li><a href="#my-manageiq-openid-connect-authentication-configuration-is-broken"><strong>My ManageIQ OpenID-Connect Authentication Configuration Is Broken</strong></a>
    <ul>
      <li><a href="#the-manageiq-login-screen"><strong>The ManageIQ Login Screen</strong></a></li>
      <li><a href="#state-of-the-manageiq-pods"><strong>State Of The ManageIQ Pods</strong></a></li>
      <li><a href="#manageiq-orchestrator-pod-log"><strong>ManageIQ Orchestrator Pod Log</strong></a></li>
      <li><a href="#manageiq-operator-pod-log"><strong>ManageIQ Operator Pod Log</strong></a></li>
      <li><a href="#manageiq-httpd-pod-log"><strong>ManageIQ HTTPD Pod Log</strong></a></li>
      <li><a href="#openid-connect-provider-accessible"><strong>OpenID-Connect Provider Accessible</strong></a></li>
      <li><a href="#capturing-user-request-headers"><strong>Capturing User Request Headers</strong></a></li>
      <li><a href="#adjusting-log-level"><strong>Adjusting Log Level</strong></a></li>
    </ul>
  </li>
  <li><a href="#reporting-issues"><strong>Reporting Issues</strong></a></li>
  <li><a href="#known-issues"><strong>Known Issues</strong></a></li>
</ul>

<h1 id="configure-manageiq-for-openid-connect-authentication">Configure ManageIQ For OpenID-Connect Authentication</h1>
<hr />

<p>Currently Containerized ManageIQ only supports the OpenID-Connect authentication configuration.</p>

<p>ManageIQ uses Apache’s <em>mod_auth_openidc</em> module to support OpenID-Connect authentication.
The instructions for configuring Apache’s <em>mod_auth_openidc</em> for ManageIQ differ for the
appliance deployment and the podified (Kubernetes) deployment.</p>

<ul>
  <li>
    <p>The instructions for configuring OpenID-Connect for a ManageIQ appliance can be found here:
<a href="https://www.manageiq.org/docs/reference/latest/auth/openid_connect.html">ManageIQ OpenID-Connect Authentication User Reference</a></p>
  </li>
  <li>
    <p>The instructions for configuring OpenID-Connect for a podifed deployment of ManageIQ can be found here:
<a href="https://github.com/ManageIQ/manageiq-pods/blob/master/manageiq-operator/README.md#configuring-openid-connect-authentication">ManageIQ Operator README</a></p>
  </li>
</ul>

<h1 id="my-manageiq-openid-connect-authentication-configuration-is-broken">My ManageIQ OpenID-Connect Authentication Configuration Is Broken</h1>
<hr />

<p>The first thing a user of ManageIQ does is to log in. Therefore if there are any issues with authentication configuration
the user is likely to file an issue that ManageIQ is not usable for them.</p>

<p>Many of the issues reported as ManageIQ authentication problems are not directly related to ManageIQ.
Instead many are rooted in failures with the configuration of the underlying authentication technology.</p>

<p>This blog post attempts to provide some guidelines for troubleshooting Containerized ManageIQ authentication issues.
The guidelines in this blog post are specific to ManageIQ running in Containers (Kubernetes, OpenShift )</p>

<p>The below sections identify key items to check and/or ask the user to gather when reporting Containerized ManageIQ
authentication issues.</p>

<h2 id="the-manageiq-login-screen">The ManageIQ Login Screen</h2>
<hr />

<p><strong>Question</strong> Does the ManageIQ login screen contain the “Log In to Corporate System” button?</p>

<p>If ManageIQ is correctly configured for OpenID-Connect authentication the ManageIQ login
screen will have a blue <strong>Log in to Corporate System</strong> button.</p>

<p>Screenshot showing the ManageIQ login screen with the <strong>Log in to Corporate System</strong> button:
<a href="/assets/images/blog/miq_login_with_corp_login.png"><img src="/assets/images/blog/miq_login_with_corp_login.png" alt="Screenshot showing the ManageIQ login screen with the button:" /></a></p>

<p>If ManageIQ is not correctly configured for OpenID-Connect authentication the ManageIQ login
screen may be missing the blue <strong>Log in to Corporate System</strong> button.</p>

<p>Screenshot showing the ManageIQ login screen without the <strong>Log in to Corporate System</strong> button:
<a href="/assets/images/blog/miq_login_without_corp_login.png"><img src="/assets/images/blog/miq_login_without_corp_login.png" alt="Screenshot showing the ManageIQ login screen without the button:" /></a></p>

<h2 id="state-of-the-manageiq-pods">State Of The ManageIQ Pods</h2>
<hr />

<p><strong>Question</strong> Are all of the ManageIQ pods running?</p>

<p>After the ManageIQ Custom Resource (CR) has been created it may take a while for all the pods to transition to <strong>Running</strong> status.</p>

<p>For instructions on creating the ManageIQ CR see: <a href="https://github.com/ManageIQ/manageiq-pods/blob/master/manageiq-operator/README.md#configuring-openid-connect-authentication">ManageIQ Operator README</a></p>

<p>The following example shows how to check the state of the pods in the ManageIQ project.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc get pods <span class="nt">-n</span> my-miq-project

    NAME                                 READY   STATUS    RESTARTS   AGE
    1-event-handler-abcdef1234-12345     1/1     Running   0          22d
    1-event-handler-abcdef1234-12345     1/1     Running   0          22d
    1-generic-abcdef1234-12345           1/1     Running   0          22d
    1-generic-abcdef1234-12345           1/1     Running   0          22d
    1-priority-abcdef1234-12345          1/1     Running   0          22d
    1-priority-abcdef1234-12345          1/1     Running   0          22d
    1-remote-console-abcdef1234-12345    1/1     Running   0          22d
    1-reporting-abcdef123-12345          1/1     Running   0          22d
    1-reporting-abcdef123-12345          1/1     Running   0          22d
    1-schedule-abcdef1234-12345          1/1     Running   0          22d
    1-ui-abcdef1234-12345                1/1     Running   0          22d
    1-web-service-abcdef1234-12345       1/1     Running   0          22d
    httpd-abcdef1234-12345               1/1     Running   0          22d
    manageiq-operator-abcdef1234-12345   1/1     Running   0          22d
    memcached-abcdef1234-12345           1/1     Running   0          22d
    orchestrator-abcdef123-12345         1/1     Running   0          22d
    postgresql-abcdef1234-12345          1/1     Running   0          22d

</code></pre></div></div>

<p>If all of the pods in the ManageIQ project do not transition to <strong>Running</strong> Status something may have failed.</p>

<h2 id="manageiq-orchestrator-pod-log">ManageIQ Orchestrator Pod Log</h2>
<hr />

<p><strong>Question</strong> Are there any errors in the Orchestrator pod logs?</p>

<p>Many things could prevent the ManageIQ pods from transitioning to the <strong>Running</strong> status including issues with
the Container infrastructure.</p>

<p>It is beyond the scope of this document to descibe how to evaluate container infrastructure soundness but that
should be confirmed. After the stability of the container infrastructure has been confirmed check the orchestrator
pod for errors.</p>

<p>The orchestrator pod will log any errors encountered creating the other pods in the ManageIQ deployment.
The following example shows how to check the orchestrator pod’s logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs orchestrator-abcdef123-12345 <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<h2 id="manageiq-operator-pod-log">ManageIQ Operator Pod Log</h2>
<hr />

<p><strong>Question</strong> Did the orchestrator pod fail to start?</p>

<p>If the orchestrator pod failed to transition to the <em>Running</em> status the
manageiq-operator pod will log any errors encountered creating
the orchestrator pod.</p>

<p>The following example shows how to check the operator pod’s logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs manageiq-operator-abcdef1234-12345 <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<h2 id="manageiq-httpd-pod-log">ManageIQ HTTPD Pod Log</h2>
<hr />

<p><strong>Question</strong> Are there any errors in the HTTPD pod logs?</p>

<p>When deploying ManageIQ in containers one pod is used to manage the authentication
configuration. This blog post is specific to the OpenID-Connect configuration,
which is implemented using the <a href="https://github.com/zmartzone/mod_auth_openidc/blob/master/README.md">mod_auth_openidc</a>
Apache module.</p>

<p>The HTTPD pod is used to configure Apache’s mod_auth_openidc module.</p>

<p>Therefore the httpd pod’s log file may contain errors related to mod_auth_openidc configuration.</p>

<p>The orchestrator pod will log any errors encountered creating the other pods in the ManageIQ deployment.</p>

<p>The following example shows how to check the httpd pod’s logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs httpd-abcdef123-12345 <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<h2 id="openid-connect-provider-accessible">OpenID-Connect Provider Accessible</h2>
<hr />

<p><strong>Question</strong> Can user data be obtained from the OpenID-Connect Provider?</p>

<p>ManageIQ has a REST API. There is a blog post that describes how to use the ManageIQ REST API
when configured with OpenID-Connect. 
see: <a href="https://www.manageiq.org/blog/2020/09/oidc-auth-api-usage/">Using the API with OpenID-Connect Authentication</a></p>

<p>One of the steps described in this blog post in the <strong>Example: Using a JWT Token</strong> contains an optional
step to do an introspection to the OpenID-Connect provider for a specific user.</p>

<p>The following snippet from the <a href="https://www.manageiq.org/blog/2020/09/oidc-auth-api-usage/">Using the API with OpenID-Connect Authentication</a> blog post shows the commands that will
directly query the OpenID-Connect Provider for a specific user.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Accessing the ManageIQ API with the access_token from a JWT Token</span>

  <span class="c"># Step 1: Request the JWT Token from the OpenID-Connect provider</span>
  <span class="nv">jwt_token</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-k</span> <span class="nt">-L</span> <span class="nt">--user</span> <span class="k">${</span><span class="nv">user</span><span class="k">}</span>:<span class="k">${</span><span class="nv">password</span><span class="k">}</span> <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="nt">-d</span> <span class="s2">"grant_type=password"</span> <span class="nt">-d</span> <span class="s2">"client_id=</span><span class="k">${</span><span class="nv">oidc_client_id</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-d</span> <span class="s2">"client_secret=</span><span class="k">${</span><span class="nv">oidc_client_secret</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-d</span> <span class="s2">"username=</span><span class="k">${</span><span class="nv">user</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-d</span> <span class="s2">"password=</span><span class="k">${</span><span class="nv">password</span><span class="k">}</span><span class="s2">"</span> <span class="k">${</span><span class="nv">oidc_provider_token_endpoint</span><span class="k">}</span> <span class="si">)</span>

  <span class="c"># Step 2: Retrieve the access_token from the JWT</span>
  <span class="nv">access_token</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$jwt_token</span> | jq <span class="nt">-r</span> <span class="s1">'.access_token'</span><span class="si">)</span>

  <span class="c"># Step 3 (OPTIONAL) Use the access_token to do an introspection to get the details for the user associated with the JWT</span>
  curl <span class="nt">-k</span> <span class="nt">-L</span> <span class="nt">--user</span> <span class="k">${</span><span class="nv">oidc_client_id</span><span class="k">}</span>:<span class="k">${</span><span class="nv">oidc_client_secret</span><span class="k">}</span> <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="nt">-d</span> <span class="s2">"token=</span><span class="k">${</span><span class="nv">access_token</span><span class="k">}</span><span class="s2">"</span> <span class="k">${</span><span class="nv">oidc_auth_introspection_endpoint</span><span class="k">}</span>
</code></pre></div></div>

<p>The output from the above introspection <em>curl</em> command should look similar to this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bob Youruncle"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"given_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bob"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Youruncle"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"preferred_username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"byouruncle"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"byouruncle@example.com"</span><span class="err">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"byouruncle.example.com"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"EvmGroup-super_administrator"</span><span class="w">
  </span><span class="p">]</span><span class="err">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"byouruncle"</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p>If an issue is encountered where a specific user is unable to log in it would be valuable to confirm this introspection returns the expected data, when performed for the failing user.</p>

<h2 id="capturing-user-request-headers">Capturing User Request Headers</h2>
<hr />

<p><strong>Question</strong> Are the user request headers valid?</p>

<p>It is possible to request extra debug output from the ManageIQ authentication code. If enabled, when a user attempts to log in
the user claims returned from Apache’s mod-auth-openidc module will be written to the UI pod’s log.</p>

<p>To enable the authentication debug data to be logged, first log into the MangeIQ user interface as the <strong>admin</strong> user and access the <strong>Advanced</strong> settings on the configuration page.</p>

<p>Screenshot showing the ManageIQ <strong>Advanced</strong> settings tab
<a href="/assets/images/blog/miq_advanced_settings.png"><img src="/assets/images/blog/miq_advanced_settings.png" alt="Screenshot showing the ManageIQ **Advanced** settings tab:" /></a></p>

<p>From the <strong>Advanced</strong> settings screen scroll down to the <strong>:authentication:</strong> section and set <strong>:debug:</strong> to <strong>true</strong></p>

<p>Screenshot showing the :authentication: :debug: set to <strong>true</strong>
<a href="/assets/images/blog/miq_authentication_debug.png"><img src="/assets/images/blog/miq_authentication_debug.png" alt="Screenshot showing the :authentication: :debug: set to **true**" /></a></p>

<p>Once the <strong>:authentication:</strong> / <strong>:debug:</strong> is to <strong>true</strong> tail the ui pod’s log while attempting to authenticate a user.</p>

<p>The following example shows how to check for the user’s request headers from the ui pod’s logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs <span class="nt">-f</span> 1-ui-abcdef1234-12345
  _content omitted_
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug) user_details_from_headers(username=byouruncle)"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug) External-Auth remote user request.headers:"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER            = </span><span class="se">\"</span><span class="s2">byouruncle</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-FIRSTNAME  = </span><span class="se">\"</span><span class="s2">Bob</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-LASTNAME   = </span><span class="se">\"</span><span class="s2">Youruncle</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-FULLNAME   = </span><span class="se">\"</span><span class="s2">Bob Youruncle</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-EMAIL      = </span><span class="se">\"</span><span class="s2">byouruncle@byouruncle.example.com</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-DOMAIN     = </span><span class="se">\"</span><span class="s2">byouruncle.example.com</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
  ... <span class="s2">"message"</span>:<span class="s2">"MIQ(Authenticator::Httpd#log_auth_debug)   X-REMOTE-USER-GROUPS     = </span><span class="se">\"</span><span class="s2">EvmGroup-super_administrator</span><span class="se">\"</span><span class="s2">"</span><span class="o">}</span>
</code></pre></div></div>

<h2 id="adjusting-log-level">Adjusting Log Level</h2>
<hr />

<p>To gain additional insight to authentication issues adjust the log level to <strong>debug</strong> on the httpd pod,
which can be done with the following commands:</p>

<ul>
  <li>Login</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
</code></pre></div></div>

<ul>
  <li>Edit the httpd configmap:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc edit configmaps/httpd-configs <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<ul>
  <li>This command will open an editor where you can adjust the log level:</li>
</ul>

<p>Search for <strong>LogLevel</strong> and change it from: <strong>LogLevel warn</strong> To: <strong>LogLevel debug</strong>, 
  and save the changes.</p>

<ul>
  <li>Get the name of the httpd pod</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc get pods <span class="nt">-n</span> my-miq-project | <span class="nb">grep </span>httpd
    httpd-abcdef1234-12345               1/1     Running   0          22d
</code></pre></div></div>

<ul>
  <li>Delete this httpd pod, which will result in a new one being created.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc delete pod httpd-abcdef1234-12345 <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<ul>
  <li>Within a short time a new httpd pod will be created with the new LogLevel</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc get pods <span class="nt">-n</span> my-miq-project | <span class="nb">grep </span>httpd
    httpd-abcdef7892-65432               1/1     Running   0          22d
</code></pre></div></div>

<ul>
  <li>Now the httpd logs will have additinal debug information</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc logs <span class="nt">-f</span> httpd-abcdef7892-65432 <span class="nt">-n</span> my-miq-project
</code></pre></div></div>

<h1 id="reporting-issues">Reporting Issues</h1>
<hr />

<p>When reporting issues, in addition to the <strong>Questions</strong> presented in the above sections, it is also
helpful to include the contents of the orchestrator log, which can be captured with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs orchestrator-abcdef123-12345 <span class="nt">-n</span> my-miq-project <span class="o">&gt;</span> my_orchestrator_pod.log 2&gt;&amp;1
</code></pre></div></div>

<p>If an issue is encountered it is important to capture the logs when the issue is reproduced and not just
the logs from the time ManageIQ was initially deployed. To do this, stream the pods’ logs with the -f flag while
the issue is being recreated.</p>

<p>In one window run these commands to capture the UI pod’s logs:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs <span class="nt">-f</span> ui-abcdef123-12345 <span class="nt">-n</span> my-miq-project <span class="o">&gt;</span> my_ui_pod.log 2&gt;&amp;1
</code></pre></div></div>

<p>In another window run these commands to capture the httpd pod’s logs:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span>oc logs <span class="nt">-f</span> httpd-abcdef123-12345 <span class="nt">-n</span> my-miq-project <span class="o">&gt;</span> my_httpd_pod.log 2&gt;&amp;1
</code></pre></div></div>

<p>While the above commands are running in separate windows reproduce the authentication issue.
  Then save the output of the commands and include them in the issue report.</p>

<p>It would also be valuable to capture the Apache OpenID-Connect configuration file in the issue report.</p>

<p>The following example shows how to capture the Apache OpenID-Connect configuration file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>oc login <span class="nt">-u</span> admin <span class="nt">-p</span> &lt;pw&gt; https://&lt;my-container-host&gt;/
  <span class="nv">$ </span><span class="nb">mkdir </span>tempdir
  <span class="nv">$ </span>oc rsync httpd-5656b77789-vjgnm:/etc/httpd/conf.d ./tempdir
  <span class="nv">$ </span><span class="nb">ls</span> ./tempdir/conf.d/authentication.conf 
</code></pre></div></div>

<h1 id="known-issues">Known Issues</h1>
<hr />

<p>When a user being authenticated belongs to a large number of groups, on the order of hundreds,</p>

<p>see: <a href="https://github.com/ManageIQ/manageiq/issues/20511">OIDC Auth fails with “oidc_cache_set: could NOT store X bytes”</a></p>

<p>This issue is resolved by adding the following line to the OpenID-Connect configuration.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  OIDCCacheShmEntrySizeMax           65536
</code></pre></div></div>

<p>Although this has been addressed upstream in ManageIQ by these two PRs, it is worth mentioning here in case
a user is not running the version with this fix.</p>

<ul>
  <li><a href="https://github.com/ManageIQ/manageiq-appliance/pull/290">Add OIDCCacheShmEntrySizeMax parameter #290</a></li>
  <li><a href="https://github.com/ManageIQ/manageiq-pods/pull/618">Add OIDCCacheShmEntrySizeMax parameter #618</a></li>
</ul>


          </div>
        </article>
      </div>

      <div class="col-xs-12 col-sm-2 blog_side">
          <div class="blog_side-group">
  <h3 class="blog_side-heading">
    Categories
  </h3>

  <ul id="blog_tag_menu" class="blog_menu">
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/announcements">announcements</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/events">events</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/collaboration">collaboration</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/releases">releases</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/sprints">sprints</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/LWIMIQ">LWIMIQ</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/developers">developers</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/tutorials">tutorials</a>
    </li>
    
    <li class="blog_menu-tag">
      <a href="/blog/tags/ruby">ruby</a>
    </li>
    
  </ul>
</div>

<div class="blog_side-group">
  <h3 class="blog_side-heading">
    Archive
  </h3>

  <ul id="blog_archive_menu" class="blog_menu">
    
    
    

    
    <li class="blog_menu-year">
      <a href="/blog/2020/index.html">
        2020
      </a>
      
        <ul class="blog_menu blog_months">
  
  
  <li class="blog_menu-month">
    <a href="/blog/2020/10/index.html">
      October
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/09/index.html">
      September
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/08/index.html">
      August
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/07/index.html">
      July
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/06/index.html">
      June
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/03/index.html">
      March
    </a>
    
  </li>
  
  <li class="blog_menu-month">
    <a href="/blog/2020/02/index.html">
      February
    </a>
    
  </li>
  
</ul>

      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2019/index.html">
        2019
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2018/index.html">
        2018
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2017/index.html">
        2017
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2016/index.html">
        2016
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2015/index.html">
        2015
      </a>
      
    </li>
    
    <li class="blog_menu-year">
      <a href="/blog/2014/index.html">
        2014
      </a>
      
    </li>
    
  </ul>
</div>

      </div>

    </div>
  </div>
</div>

    </main>

    <footer class="site-footer">
  <div class="footer-row" id="footer_top">
    <div class="footer-group">
      <img class="footer-logo" src="/assets/images/manageiq-glyph-inverse.svg" alt="ManageIQ">
      <ul class="site_nav">
  <li >
    <a href="/download/">Download</a>
  </li>
  <li >
    <a href="/docs/">Documentation</a>
  </li>
  <li >
    <a href="/community/">Community</a>
  </li>
  <li class="active">
    <a href="/blog/">Blog</a>
  </li>
</ul>

    </div>


    <ul class="contact_menu">
      <li>
        <a href="https://github.com/ManageIQ/">
          <i class="fa fa-github"></i>
          Github
        </a>
      </li>
      <li>
        <a href="https://gitter.im/ManageIQ/manageiq">
          <i class="fa fa-gitter">
            <svg viewBox="45 47 78 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 40.1 (33804) - http://www.bohemiancoding.com/sketch -->
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(45.000000, 47.000000)">
        <g id="icon-gitter" transform="translate(10.000000, 0.000000)">
            <rect id="Rectangle-path" x="0" y="0.5" width="8.25" height="61"></rect>
            <rect id="Rectangle-path" x="49.75" y="14.5" width="8.25" height="47"></rect>
            <rect id="Rectangle-path" x="16.5" y="14.5" width="8.25" height="80.25"></rect>
            <rect id="Rectangle-path" x="33.25" y="14.5" width="8.25" height="80.25"></rect>
        </g>
    </g>
</svg>

          </i>
          Gitter
        </a>
      </li>
      <li>
        <a href="http://talk.manageiq.org/">
          <i class="fa fa-comments"></i>
          Forum
        </a>
      </li>
      
      <li>
        <a href="https://github.com/ManageIQ/manageiq.org/edit/master/site/_posts/2020-09-21-troubleshooting-containerized-oidc.md">
          <i class="fa fa-pencil"></i>
          Edit this page
        </a>
      </li>
      
    </ul>
  </div>

  <div class="footer-row" id="footer_bottom">
    <div class="footer-legal">
      <span class="copyright">
        &copy; 2020 ManageIQ.
      </span>
      <span>
        <a href="http://community.redhat.com/software/" target="_blank">
          Sponsored by Red Hat, Inc.
        </a>
      </span>
      <span>
        <a href="/logo/" class="footer-link">Logo</a>
      </span>
      <span>
        <a href="/security/" class="footer-link">Security</a>
      </span>
      <span>
        <a href="/legal/" class="footer-link">Legal &amp; Privacy</a>
      </span>
    </div>

    <div class="footer-social">
      <ul class="social_menu">
        <li>
          <a href="https://twitter.com/ManageIQ" class="social_link social_link-twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>

        <li>
          <a href="https://www.facebook.com/manageiq/" class="social_link social_link-facebook">
            <span class="social_link-icon">
              <i class="fa fa-facebook"></i>
            </span>
          </a>
        </li>

        <!--  -->
        <li>
          <a href="https://www.linkedin.com/company/manageiq" class="social_link social_link-linkedin">
            <span class="social_link-icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
        </li>

        <li>
          <a href="https://www.youtube.com/user/ManageIQVideo" class="social_link social_link-youtube">
            <span class="social_link-icon">
              <i class="fa fa-youtube"></i>
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

    <div id="lightbox">
  <header class="lightbox-header">
    <div class="lightbox-title"></div>
    <div class="lightbox-close">
      <span class="fa fa-times"></span>
    </div>
  </header>

  <div class="lightbox-image">
    <img src="" alt="">
  </div>
</div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="/assets/js/main.js" charset="utf-8"></script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58883457-1', 'auto');
  ga('send', 'pageview');

</script>
    
  </body>
</html>
